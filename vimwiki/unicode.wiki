= Unicode ä¸Ž UTF-8 =

Unicode æ˜¯æŠ½è±¡çš„æ•°å­—ç¼–ç ï¼ŒUTF-8 æ˜¯å…·ä½“çš„å­—èŠ‚ç¼–ç ã€‚

* https://zh.wikipedia.org/wiki/Unicode
* https://zh.wikipedia.org/wiki/UTF-8
* https://unicode-table.com/

| ç¬¬ä¸€ä¸ªå­—èŠ‚ | ç¬¬äºŒä¸ªå­—èŠ‚ | ç¬¬ä¸‰ä¸ªå­—èŠ‚ | ç¬¬å››ä¸ªå­—èŠ‚ | ç”¨äºŽå®žé™…ç¼–ç çš„ bit æ•°é‡ | èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼ |
| -          | -          | -          | -          | -                       | -              |
| 0xxxxxxx   |            |            |            | 7                       | 127            |
| 110xxxxx   | 10xxxxxx   |            |            | 11                      | 2047           |
| 1110xxxx   | 10xxxxxx   | 10xxxxxx   |            | 16                      | 65535          |
| 11110xxx   | 10xxxxxx   | 10xxxxxx   | 10xxxxxx   | 21                      | 1114111        |

Python ä¸­ï¼Œå¯ä»¥ç”¨ `\u` æˆ– `\U` å‰ç¼€è¡¨ç¤º Unicode å­—ç¬¦, å¦‚ `'\U0010ffff', '\uffff', '\U00000042', '\u0042'`ã€‚

=== emoji ä¾‹å­ ðŸ˜‹ ===

Python:

{{{py
>>> s = 'ðŸ˜‹'
>>> s.encode()
b'\xf0\x9f\x98\x8b'
>>> import json
>>> json.dumps(s)
'"\\ud83d\\ude0b"'
>>> ord(s)
128523
>>> len(s)
1
}}}

ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨å†…å­˜ä¸­ï¼Œæ™®é€š ascii å­—ç¬¦å ç”¨ 1 å­—èŠ‚ï¼Œæ™®é€šæ±‰å­—å ç”¨ 2 å­—èŠ‚ï¼Œemoji å­—ç¬¦å ç”¨ 4 å­—èŠ‚ï¼Œè™½ç„¶ä»–ä»¬éƒ½æ˜¯é•¿åº¦ 1ã€‚

ä¸€ä¸ªå­—ç¬¦ä¸²åŒ…å«å¤šç§å­—ç¬¦æ—¶ï¼Œå ç”¨å†…å­˜ä¸º æœ€å å†…å­˜çš„å­—ç¬¦ x é•¿åº¦ï¼Œ`"s" * 1024` å  1K å†…å­˜ï¼Œ`"s" * 1023 + "ðŸ˜‹"` å  4k å†…å­˜ã€‚


JavaScript:

{{{js
> const s = 'ðŸ˜‹'
> s.length
2
> (s + 'x').length
3
> (s + 'ä¸­').length
3
> new TextEncoder().encode(s)
Uint8Array [ 240, 159, 152, 139 ]
> new TextEncoder().encode('ä¸­')
Uint8Array [ 228, 184, 173 ]

> const n = 1024*1024*100
> const ss = 'ðŸ˜‹'.repeat(n)
> ss.indexOf('x')  // active this string
-1
// memory usage 400M

> const ss = 'ä¸­'.repeat(n); ss.indexOf('x')
// memory usage 200M

> const ss = 's'.repeat(n); ss.indexOf('x')
// memory usage 100M

> const ss = 's'.repeat(n) + 'ä¸­'.repeat(n); ss.indexOf('x')
// memory usage 400M, is 200M + 200M, not 100M + 200M

> const ss = 's'.repeat(n) + 'ðŸ˜‹'.repeat(n);; ss.indexOf('x')
// memory usage 600M, is 200M + 2 * 200M
}}}

JavaScript çš„å†…å­˜ä½¿ç”¨æƒ…å†µä¸Ž Python ç±»ä¼¼ï¼Œæœ‰å¯¹æ™®é€šçº¯ ascii å­—ç¬¦ä¸²åšä¼˜åŒ–ã€‚
`emoji.length == 2`ï¼Œå› ä¸ºå­—ç¬¦åœ¨å†…å­˜ä¸­ä½¿ç”¨ UTF-16 ç¼–ç å­˜æ”¾ï¼Œ`.length` è¿”å›žçš„æ˜¯ UTF-16 çš„å•å…ƒæ•°é‡ã€‚emoji è¢«è®¤ä¸ºæ˜¯ 2 å•å…ƒå  4 å­—èŠ‚å†…å­˜ã€‚

Python æ— æ³•å­˜å‚¨éžæ³•çš„ unicodeï¼š
{{{py
>>> bytes([254,255]).decode()
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeDecodeError: 'utf-8' codec can't decode byte 0xfe in position 0: invalid start byte
}}}
